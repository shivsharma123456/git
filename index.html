<html>

<body>
  <form onsubmit="saveToLocalStorage(event)">
    <label>Name:</label>
    <input type="text" name="username" required />

    <label>Email:</label>
    <input type="email" name="emailId" required />

    <label>Phone Number:</label>
    <input type="tel" name="phonenumber" />

    <button type="submit">Submit</button>
  </form>

  <ul id="user-details"></ul>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.4/axios.min.js"> </script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      axios.get("https://crudcrud.com/api/52b4b3f9edb243ba9283dafdb2126553/appoinmentData")
        .then((response) => {
          response.data.forEach(userDetails => {
            showUserOnScreen(userDetails);
          });
        })
        .catch((error) => {
          console.error(error);
        });
    });

    function saveToLocalStorage(event) {
      event.preventDefault();
      const name = event.target.username.value;
      const email = event.target.emailId.value;
      const phonenumber = event.target.phonenumber.value;

      localStorage.setItem('name', name);
      localStorage.setItem('email', email);
      localStorage.setItem('phonenumber', phonenumber);

      const userDetails = {
        name: name,
        email: email,
        phonenumber: phonenumber,
      };
      axios.post("https://crudcrud.com/api/52b4b3f9edb243ba9283dafdb2126553/appoinmentData", userDetails)
        .then((response) => {
          showUserOnScreen(response.data);
        })
        .catch((error) => {
          console.error(error);
        });
    }

    function showUserOnScreen(userDetails) {
      const parentElem = document.getElementById('user-details');

      const childElem = document.createElement('li');

      childElem.textContent = userDetails.name + ' (' + userDetails.email + ')' + " " + userDetails.phonenumber;

      const editButton = document.createElement('input');
      editButton.type = 'button';
      editButton.value = 'Edit';
      editButton.onclick = () => {
        editUserDetails(userDetails);
      };

      const deleteButton = document.createElement('input');
      deleteButton.type = 'button';
      deleteButton.value = 'Delete';
      deleteButton.onclick = () => {
        axios.delete("https://crudcrud.com/api/52b4b3f9edb243ba9283dafdb2126553/appoinmentData/" + userDetails._id)
          .then((response) => {
            parentElem.removeChild(childElem);
          })
          .catch((error) => {
            console.error(error);
          });
      };

      childElem.appendChild(editButton);
      childElem.appendChild(deleteButton);
      parentElem.appendChild(childElem);
    }

    function editUserDetails(userDetails) {
      const nameInput = prompt('Enter your name', userDetails.name);
      const emailInput = prompt('Enter your email', userDetails.email);
      const phoneInput = prompt('Enter your phone number', userDetails.phonenumber);

      const updatedUserDetails = {
        name: nameInput,
        email: emailInput,
        phonenumber: phoneInput,
      };

      axios.put("https://crudcrud.com/api/52b4b3f9edb243ba9283dafdb2126553/appoinmentData/" + userDetails + userDetails + "._id", updatedUserDetails)
        .then((response) => {
          const updatedDetails = response.data;
          const parentElem = document.getElementById('user-details');
          const childElems = parentElem.childNodes;
          for (let i = 0; i < childElems.length; i++) {
            const childElem = childElems[i];
            if (childElem.textContent.includes(userDetails.name) && childElem.textContent.includes(userDetails.email) && childElem.textContent.includes(userDetails.phonenumber)) {
              childElem.textContent = updatedDetails.name + ' (' + updatedDetails.email + ')' + " " + updatedDetails.phonenumber;
              break;
            }
          }
        })
        .catch((error) => {
          console.error(error);
        });
    }
  </script>
</body>

</html>